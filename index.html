<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 정의 말씀 슬라이드</title>
    <!-- html2canvas library for screenshot functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5gI9kLmbG4dGzcPTQsROJAgaA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+KR:wght@400;700&family=Nanum+Gothic:wght@400;700&family=Gowun+Batang:wght@400;700&family=Jua&family=Do+Hyeon&family=Black+Han+Sans&family=East+Sea+Dokdo&family=Gaegu&family=Single+Day&family=Spoqa+Han+Sans+Neo:wght@400;700&family=IBM+Plex+Sans+KR:wght@400;700&family=Tmoney+Round+Wind:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Custom Properties (Variables) for easy color changes */
        :root {
            --bg-color: #f8fafc; /* Default light background */
            --main-text-color: #1e293b; /* Default body text color (for controls, etc.) */
            --verse-text-color: #ffffff; /* Default verse text color inside box */
            --reference-text-color: #cbd5e1; /* Default reference text color */
            --accent-color: #fcd34d; /* Default yellow accent color for line */
            --highlight-text-color: #60a5fa; /* Default blue for highlighted text */
            --box-bg-color: #1e293b; /* Default dark box background */
            --button-color: #3b82f6; /* Fixed button color */
        }

        body {
            font-family: 'Inter', sans-serif; /* 기본 폰트 설정 */
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column; /* 컨트롤 패널을 상단에 배치하기 위함 */
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color); /* 배경색 변수 적용 */
            color: var(--main-text-color); /* 기본 텍스트 색상 변수 적용 */
            overflow-y: auto; /* Allow scrolling for controls on small screens */
            padding: 1rem 0;
            transition: background-color 0.3s ease; /* 배경색 전환 애니메이션 */
        }

        /* Font classes */
        .font-noto-sans-kr { font-family: 'Noto Sans KR', sans-serif; }
        .font-nanum-gothic { font-family: 'Nanum Gothic', sans-serif; }
        .font-gowun-batang { font-family: 'Gowun Batang', serif; }
        .font-jua { font-family: 'Jua', sans-serif; }
        .font-do-hyeon { font-family: 'Do Hyeon', sans-serif; }
        .font-black-han-sans { font-family: 'Black Han Sans', sans-serif; }
        .font-east-sea-dokdo { font-family: 'East Sea Dokdo', cursive; }
        .font-gaegu { font-family: 'Gaegu', cursive; }
        .font-single-day { font-family: 'Single Day', cursive; }
        .font-inter { font-family: 'Inter', sans-serif; }
        .font-spoqa-han-sans-neo { font-family: 'Spoqa Han Sans Neo', sans-serif; }
        .font-ibm-plex-sans-kr { font-family: 'IBM Plex Sans KR', sans-serif; }
        .font-tmoney-round-wind { font-family: 'Tmoney Round Wind', sans-serif; }

        /* Highlight Style */
        .highlight {
            color: var(--highlight-text-color);
            font-weight: 700; /* Make highlighted text bolder */
        }

        /* Controls Panel */
        .controls {
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap; /* 작은 화면에서 줄바꿈 */
            justify-content: center;
            align-items: center;
            gap: 1rem;
            background-color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            position: relative;
            z-index: 10;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .controls label {
            font-size: 1rem;
            font-weight: 600;
            color: #334155; /* Tailwind slate-700 */
            white-space: nowrap;
        }

        .controls select,
        .controls input,
        .controls button.action-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #cbd5e1; /* Tailwind slate-300 */
            background-color: #f8fafc; /* Tailwind slate-50 */
            font-size: 1rem;
            font-weight: 500;
            color: #1e293b; /* Tailwind slate-800 */
            cursor: pointer;
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
        }

        .controls select:focus,
        .controls input:focus,
        .controls button.action-button:focus {
            border-color: #3b82f6; /* Tailwind blue-500 */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }

        /* Color input specific styling */
        .controls input[type="color"] {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            width: 40px; height: 40px; padding: 0; border: none; background: none; cursor: pointer;
        }
        .controls input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        .controls input[type="color"]::-webkit-color-swatch { border: 1px solid #cbd5e1; border-radius: 0.5rem; }
        .controls input[type="color"]::-moz-color-swatch { border: 1px solid #cbd5e1; border-radius: 0.5rem; }

        /* Action buttons styling */
        .controls button.action-button {
            color: white;
            font-weight: 600;
        }
        .controls button#screenshotBtn { background-color: #10b981; } /* Emerald */
        .controls button#screenshotBtn:hover { background-color: #059669; }
        .controls button#addVerseBtn { background-color: #8b5cf6; } /* Violet */
        .controls button#addVerseBtn:hover { background-color: #7c3aed; }
        .controls button#highlightBtn { background-color: #0d9488; } /* Teal */
        .controls button#highlightBtn:hover { background-color: #0f766e; }
        .controls button.action-button:disabled { background-color: #9ca3af; cursor: not-allowed; }

        /* Main Slide Area */
        .slide-wrapper {
            width: 90%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
            position: relative;
        }

        .verse-box {
            background-color: var(--box-bg-color);
            border-radius: 1rem;
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            padding: 2.5rem 3rem;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: relative;
            transition: background-color 0.3s ease;
        }

        .verse-text-container { position: relative; padding-left: 1.5rem; }
        .vertical-line { position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background-color: var(--accent-color); border-radius: 3px; transition: background-color 0.3s ease; }
        .verse-text { font-size: 2.2rem; line-height: 1.7; color: var(--verse-text-color); font-weight: 600; transition: color 0.3s ease; }
        .verse-reference { font-size: 1.3rem; color: var(--reference-text-color); font-weight: 400; text-align: right; margin-top: 1rem; transition: color 0.3s ease; }

        /* Navigation Buttons */
        .navigation-buttons { display: flex; justify-content: space-between; width: 100%; max-width: 400px; margin-top: 2rem; }
        .nav-button { background-color: var(--button-color); color: white; padding: 0.8rem 2rem; border: none; border-radius: 9999px; cursor: pointer; font-size: 1.1rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .nav-button:hover { background-color: #2563eb; transform: translateY(-2px); box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15); }
        .nav-button:disabled { background-color: #9ca3af; cursor: not-allowed; box-shadow: none; transform: none; }

        /* Add Verse Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); width: 90%; max-width: 500px; display: flex; flex-direction: column; gap: 1rem; }
        .modal-content h2 { margin-top: 0; font-size: 1.5rem; font-weight: 700; color: #1e293b; }
        .modal-content .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .modal-content label { font-weight: 600; color: #475569; }
        .modal-content input, .modal-content textarea { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 1rem; box-sizing: border-box; }
        .modal-content textarea { resize: vertical; min-height: 120px; }
        .modal-buttons { display: flex; justify-content: flex-end; gap: 0.75rem; margin-top: 1rem; }
        .modal-buttons button { padding: 0.6rem 1.2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; }
        .modal-buttons .save-btn { background-color: #3b82f6; color: white; }
        .modal-buttons .cancel-btn { background-color: #e2e8f0; color: #475569; }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .controls { flex-direction: column; align-items: stretch; }
            .verse-text { font-size: 1.6rem; }
            .verse-reference { font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <!-- Controls Panel -->
    <div class="controls">
        <div class="control-group">
            <label for="font-select">글꼴:</label>
            <select id="font-select">
                <option value="inter">Inter (기본)</option>
                <option value="noto-sans-kr">Noto Sans KR</option>
                <option value="nanum-gothic">나눔고딕</option>
                <option value="gowun-batang">고운바탕</option>
                <option value="jua">주아체</option>
                <option value="do-hyeon">도현체</option>
                <option value="black-han-sans">Black Han Sans</option>
                <option value="east-sea-dokdo">동해독도체</option>
                <option value="gaegu">개구체</option>
                <option value="single-day">싱글데이체</option>
                <option value="spoqa-han-sans-neo">이롭게바탕</option>
                <option value="ibm-plex-sans-kr">프리젠테이션</option>
                <option value="tmoney-round-wind">티머니라운드</option>
            </select>
        </div>
        <div class="control-group">
            <label for="verse-select">구절 선택:</label>
            <select id="verse-select"></select>
        </div>
        <div class="control-group">
            <label for="highlight-input">강조 단어:</label>
            <input type="text" id="highlight-input" placeholder="단어1,단어2...">
            <button id="highlightBtn" class="action-button" style="padding: 0.5rem;">강조</button>
        </div>
        <div class="control-group">
            <label for="bg-color-picker">배경색:</label> <input type="color" id="bg-color-picker" value="#f8fafc">
        </div>
        <div class="control-group">
            <label for="verse-box-bg-color-picker">상자 배경:</label> <input type="color" id="verse-box-bg-color-picker" value="#1e293b">
        </div>
        <div class="control-group">
            <label for="verse-text-color-picker">말씀색:</label> <input type="color" id="verse-text-color-picker" value="#ffffff">
        </div>
        <div class="control-group">
            <label for="reference-text-color-picker">참조색:</label> <input type="color" id="reference-text-color-picker" value="#cbd5e1">
        </div>
        <div class="control-group">
            <label for="accent-color-picker">막대바 색:</label> <input type="color" id="accent-color-picker" value="#fcd34d">
        </div>
        <div class="control-group">
            <label for="highlight-color-picker">단어 강조색:</label> <input type="color" id="highlight-color-picker" value="#60a5fa">
        </div>
        <div class="control-group">
             <button id="addVerseBtn" class="action-button">말씀 추가</button>
             <button id="screenshotBtn" class="action-button">스크린샷 저장</button>
        </div>
    </div>

    <!-- Main Slide Area -->
    <div class="slide-wrapper" id="slideWrapper">
        <div class="verse-box">
            <div class="verse-text-container">
                <div class="vertical-line"></div>
                <div class="verse-text" id="verseText"></div>
            </div>
            <div class="verse-reference" id="verseReference"></div>
        </div>
        <div class="navigation-buttons">
            <button id="prevBtn" class="nav-button">이전</button>
            <button id="nextBtn" class="nav-button">다음</button>
        </div>
    </div>

    <!-- Add Verse Modal -->
    <div id="addVerseModal" class="modal-overlay">
        <div class="modal-content">
            <h2>새 말씀 구절 추가</h2>
            <form id="addVerseForm">
                <div class="form-group">
                    <label for="newVerseReference">참조 (예: 요한복음 3:16)</label>
                    <input type="text" id="newVerseReference" required>
                </div>
                <div class="form-group">
                    <label for="newVerseText">말씀 내용</label>
                    <textarea id="newVerseText" rows="4" required></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" id="cancelAddVerseBtn">취소</button>
                    <button type="submit" class="save-btn">저장</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        const initialVerses = [
             { reference: "이사야 55:1", text: "너희 목마른 자들아 물로 나아오라 돈 없는 자도 오라 너희는 와서 사 먹되 돈 없이, 값 없이 와서 포도주와 젖을 사라" },
            { reference: "시편 90:10", text: "우리의 년수가 칠십이요 강건하면 팔십이라도 그 년수의 자랑은 수고와 슬픔 뿐이요 신속히 가니 우리가 날아가나이다" },
            { reference: "이사야 55:3", text: "너희는 귀를 기울이고 내게 나아와 들으라 그리하면 너희 영혼이 살리라 내가 너희에게 영원한 언약을 세우리니 곧 다윗에게 허락한 확실한 은혜니라" },
            { reference: "요한복음 8:32", text: "진리를 알찌니 진리가 너희를 자유케 하리라" },
            // ... (The rest of the verses are omitted for brevity but should be here)
            { reference: "로마서 5:8", text: "우리가 아직 죄인 되었을 때에 그리스도께서 우리를 위하여 죽으심으로 하나님께서 우리에게 대한 자기의 사랑을 확증하셨느니라" },
            { reference: "요한복음 3:16", text: "하나님이 세상을 이처럼 사랑하사 독생자를 주셨으니 이는 저를 믿는 자마다 멸망치 않고 영생을 얻게 하려 하심이니라" }
        ];

        let verses = [];
        let currentSlideIndex = 0;
        let isTransitioning = false;
        let isCapturing = false;

        // DOM elements
        const verseText = document.getElementById('verseText');
        const verseReference = document.getElementById('verseReference');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const slideWrapper = document.getElementById('slideWrapper');
        const fontSelect = document.getElementById('font-select');
        const verseSelect = document.getElementById('verse-select');
        const bgColorPicker = document.getElementById('bg-color-picker');
        const verseBoxBgColorPicker = document.getElementById('verse-box-bg-color-picker');
        const verseTextColorPicker = document.getElementById('verse-text-color-picker');
        const referenceTextColorPicker = document.getElementById('reference-text-color-picker');
        const accentColorPicker = document.getElementById('accent-color-picker');
        const highlightColorPicker = document.getElementById('highlight-color-picker');
        const screenshotBtn = document.getElementById('screenshotBtn');
        
        // Highlight elements
        const highlightInput = document.getElementById('highlight-input');
        const highlightBtn = document.getElementById('highlightBtn');

        // Modal elements
        const addVerseBtn = document.getElementById('addVerseBtn');
        const addVerseModal = document.getElementById('addVerseModal');
        const addVerseForm = document.getElementById('addVerseForm');
        const cancelAddVerseBtn = document.getElementById('cancelAddVerseBtn');
        const newVerseReferenceInput = document.getElementById('newVerseReference');
        const newVerseTextInput = document.getElementById('newVerseText');

        // --- Data Persistence ---
        function saveStateToLocalStorage() {
            const state = {
                verses: verses,
                highlightWords: highlightInput.value
            };
            localStorage.setItem('customBibleAppState', JSON.stringify(state));
        }

        function loadStateFromLocalStorage() {
            const savedState = localStorage.getItem('customBibleAppState');
            if (savedState) {
                const state = JSON.parse(savedState);
                verses = state.verses && state.verses.length > 0 ? state.verses : initialVerses;
                highlightInput.value = state.highlightWords || '';
            } else {
                verses = initialVerses;
            }
        }

        // --- Core Slide Logic ---
        function updateSlide() {
            if (verses.length === 0) {
                verseText.textContent = "말씀을 추가해주세요.";
                verseReference.textContent = "";
                updateButtonStates();
                return;
            }
            const verse = verses[currentSlideIndex];
            const highlightWords = highlightInput.value.trim().split(',').filter(word => word.trim() !== '');

            verseReference.textContent = verse.reference;
            
            let newText = verse.text;

            // Apply highlight for each word
            if (highlightWords.length > 0) {
                // To avoid issues with nested spans, we build a single regex
                const escapedWords = highlightWords.map(word => word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'));
                const regex = new RegExp(`(${escapedWords.join('|')})`, 'gi');
                newText = verse.text.replace(regex, `<span class="highlight">$1</span>`);
            }
            
            verseText.innerHTML = newText;
            verseSelect.value = currentSlideIndex;
            updateButtonStates();
        }

        function updateButtonStates() {
            const disabled = isTransitioning || isCapturing;
            prevBtn.disabled = currentSlideIndex === 0 || disabled || verses.length === 0;
            nextBtn.disabled = currentSlideIndex === verses.length - 1 || disabled || verses.length === 0;
            screenshotBtn.disabled = disabled || verses.length === 0;
            addVerseBtn.disabled = disabled;
            highlightBtn.disabled = disabled;
            
            if (isCapturing) {
                screenshotBtn.textContent = '저장 중...';
            } else {
                screenshotBtn.textContent = '스크린샷 저장';
            }
        }

        function transitionSlide(newIndex) {
            if (isTransitioning || isCapturing) return;
            if (newIndex < 0 || newIndex >= verses.length) return;

            isTransitioning = true;
            updateButtonStates();
            slideWrapper.style.opacity = '0';
            
            setTimeout(() => {
                currentSlideIndex = newIndex;
                updateSlide();
                slideWrapper.style.transition = 'none';
                slideWrapper.style.opacity = '0';
                void slideWrapper.offsetWidth;
                setTimeout(() => {
                    slideWrapper.style.transition = 'opacity 0.5s ease-in-out';
                    slideWrapper.style.opacity = '1';
                    setTimeout(() => {
                        isTransitioning = false;
                        updateButtonStates();
                    }, 500);
                }, 10);
            }, 500);
        }

        function refreshVerseSelect() {
            verseSelect.innerHTML = ''; // Clear existing options
            verses.forEach((verse, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = verse.reference;
                verseSelect.appendChild(option);
            });
            verseSelect.value = currentSlideIndex;
        }

        // --- Screenshot Logic ---
        async function captureScreenshot() {
            if (isCapturing || verses.length === 0) return;
            isCapturing = true;
            updateButtonStates();
            try {
                const elementToCapture = document.getElementById('slideWrapper');
                const navButtons = elementToCapture.querySelector('.navigation-buttons');
                navButtons.style.display = 'none';

                const sourceCanvas = await html2canvas(elementToCapture, { useCORS: true, scale: 4, backgroundColor: null }); // Increased scale for higher resolution
                navButtons.style.display = 'flex';

                const finalCanvas = document.createElement('canvas');
                // Set canvas size to 4K UHD
                finalCanvas.width = 3840;
                finalCanvas.height = 2160;
                const ctx = finalCanvas.getContext('2d');
                ctx.fillStyle = getComputedStyle(document.body).backgroundColor;
                ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);

                const sourceAspectRatio = sourceCanvas.width / sourceCanvas.height;
                const targetAspectRatio = finalCanvas.width / finalCanvas.height;
                let drawWidth, drawHeight, x, y;
                if (sourceAspectRatio > targetAspectRatio) {
                    drawWidth = finalCanvas.width;
                    drawHeight = drawWidth / sourceAspectRatio;
                    x = 0;
                    y = (finalCanvas.height - drawHeight) / 2;
                } else {
                    drawHeight = finalCanvas.height;
                    drawWidth = drawHeight * sourceAspectRatio;
                    y = 0;
                    x = (finalCanvas.width - drawWidth) / 2;
                }
                ctx.drawImage(sourceCanvas, x, y, drawWidth, drawHeight);

                const imageURL = finalCanvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = imageURL;
                const date = new Date();
                const filename = `${verses[currentSlideIndex].reference.replace(/[:–\s]/g, '_')}_${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2,'0')}${date.getDate().toString().padStart(2,'0')}_4K.png`;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Screenshot error:', error);
                alert('스크린샷 생성에 실패했습니다.');
            } finally {
                isCapturing = false;
                updateButtonStates();
            }
        }

        // --- Modal Logic ---
        function openModal() {
            addVerseModal.style.display = 'flex';
        }

        function closeModal() {
            addVerseModal.style.display = 'none';
            addVerseForm.reset();
        }

        function handleAddVerse(event) {
            event.preventDefault();
            const newRef = newVerseReferenceInput.value.trim();
            const newText = newVerseTextInput.value.trim();

            if (!newRef || !newText) {
                alert('참조와 말씀 내용을 모두 입력해주세요.');
                return;
            }

            verses.push({ reference: newRef, text: newText });
            saveStateToLocalStorage();
            
            const newIndex = verses.length - 1;
            currentSlideIndex = newIndex;
            
            refreshVerseSelect();
            updateSlide();
            closeModal();
        }

        // --- Event Listeners ---
        prevBtn.addEventListener('click', () => transitionSlide(currentSlideIndex - 1));
        nextBtn.addEventListener('click', () => transitionSlide(currentSlideIndex + 1));
        screenshotBtn.addEventListener('click', captureScreenshot);
        fontSelect.addEventListener('change', (event) => {
            document.body.className = document.body.className.replace(/font-[\w-]+/g, '');
            document.body.classList.add(`font-${event.target.value}`);
        });
        verseSelect.addEventListener('change', (event) => {
            transitionSlide(parseInt(event.target.value));
        });

        // Highlight listeners
        highlightBtn.addEventListener('click', () => {
            updateSlide();
            saveStateToLocalStorage();
        });
        highlightInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                highlightBtn.click();
            }
        });

        // Color pickers
        bgColorPicker.addEventListener('input', (event) => {
            document.documentElement.style.setProperty('--bg-color', event.target.value);
            document.body.style.backgroundColor = event.target.value;
        });
        verseBoxBgColorPicker.addEventListener('input', (event) => { document.documentElement.style.setProperty('--box-bg-color', event.target.value); });
        verseTextColorPicker.addEventListener('input', (event) => { document.documentElement.style.setProperty('--verse-text-color', event.target.value); });
        referenceTextColorPicker.addEventListener('input', (event) => { document.documentElement.style.setProperty('--reference-text-color', event.target.value); });
        
        accentColorPicker.addEventListener('input', (event) => { 
            document.documentElement.style.setProperty('--accent-color', event.target.value);
        });

        highlightColorPicker.addEventListener('input', (event) => {
            document.documentElement.style.setProperty('--highlight-text-color', event.target.value);
            updateSlide(); // Re-render slide to apply new highlight color
        });

        // Modal event listeners
        addVerseBtn.addEventListener('click', openModal);
        cancelAddVerseBtn.addEventListener('click', closeModal);
        addVerseModal.addEventListener('click', (event) => {
            if (event.target === addVerseModal) closeModal();
        });
        addVerseForm.addEventListener('submit', handleAddVerse);

        // --- Initial Load ---
        function initialize() {
            loadStateFromLocalStorage();
            refreshVerseSelect();
            updateSlide();
        }

        initialize();
    </script>
</body>
</html>
